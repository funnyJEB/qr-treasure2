<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>QR ë³´ë¬¼ì°¾ê¸°_byê¸ˆë°°ê³¼í•™</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Gamja+Flower&display=swap" rel="stylesheet">
    
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>

    <style>
        /* [ìŠ¤íƒ€ì¼ ì •ì˜] */
        :root {
            --primary: #4CAF50;
            --secondary: #FF9800;
            --bg: #F0F9F0;
            --text: #333;
            --locked: #7f8c8d;
        }
        body {
            font-family: 'Gamja Flower', sans-serif;
            background-color: var(--bg);
            margin: 0;
            padding: 0;
            color: var(--text);
            text-align: center;
        }
        
        .container {
            max-width: 500px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
        }

        /* 1. ì‹œì‘ í™”ë©´ */
        #start-screen {
            padding: 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
        }
        .main-img { width: 80%; max-height: 300px; object-fit: cover; border-radius: 20px; margin: 20px 0; }

        /* 2. ê²Œì„ í™”ë©´ */
        #game-screen { display: none; padding: 20px; }
        #reader { width: 100%; border-radius: 15px; overflow: hidden; background: #000; margin-bottom: 20px; }

        /* ğŸ”¥ [í•µì‹¬] ìµœì¢… ëª©í‘œ êµ¬ì—­ (ìƒë‹¨ ë³´ë¬¼ìƒì) */
        .goal-area {
            background: #fff3e0;
            border: 2px dashed var(--secondary);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .goal-area:active { transform: scale(0.98); }
        .goal-icon { font-size: 4rem; display: block; margin-bottom: 5px; }
        .goal-title { font-size: 1.3rem; margin: 0; color: #d35400; font-weight: bold; }
        .goal-progress { font-size: 1rem; color: #666; margin-top: 5px; }
        
        /* ì ê¸ˆ í•´ì œ ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes shake {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(-5deg); }
            50% { transform: rotate(5deg); }
            75% { transform: rotate(-5deg); }
            100% { transform: rotate(0deg); }
        }
        .unlocked-anim { animation: shake 0.5s infinite; }

        /* ê°€ë°© (ì¸ë²¤í† ë¦¬) */
        .bag-container { background: #eee; border-radius: 15px; padding: 15px; }
        .bag-title { margin: 0 0 10px 0; font-size: 1.2rem; }
        .grid-box { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
        .item-slot {
            aspect-ratio: 1/1; background: white; border-radius: 10px;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.5rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            cursor: pointer;
        }
        .item-slot.locked { color: #ccc; background: #ddd; cursor: default; }

        /* 3. íŒì—… */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); z-index: 999; display: none;
            align-items: center; justify-content: center;
        }
        .modal-box {
            background: white; width: 85%; max-width: 400px;
            border-radius: 20px; padding: 25px; text-align: center;
            position: relative; max-height: 85vh; overflow-y: auto;
        }
        .image-scroll-box {
            display: flex; flex-direction: column; gap: 10px; margin: 15px 0;
            max-height: 250px; overflow-y: auto; border-radius: 10px;
        }
        .reward-img { width: 100%; border-radius: 10px; }
        .btn {
            background: var(--primary); color: white; border: none;
            padding: 12px 30px; font-size: 1.2rem; border-radius: 50px;
            cursor: pointer; font-family: 'Gamja Flower', sans-serif; margin-top: 10px;
        }
        .btn-secondary { background: var(--secondary); }
        input[type="text"] {
            width: 80%; padding: 10px; font-size: 1.1rem;
            border: 2px solid #ddd; border-radius: 10px; margin: 10px 0; text-align: center;
        }
    </style>
</head>
<body>

<div class="container">
    
    <div id="start-screen">
        <h1 id="title-text" style="font-size: 2.5rem; margin-bottom: 10px;">ë¡œë”©ì¤‘...</h1>
        <p id="subtitle-text" style="font-size: 1.2rem; color: #666;">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”</p>
        <img id="intro-img" class="main-img" src="" alt="Intro">
        <p id="intro-desc" style="white-space: pre-wrap;">ì„¤ëª…ê¸€ ë¡œë”©ì¤‘...</p>
        <button class="btn" onclick="Game.start()">íƒí—˜ ì‹œì‘í•˜ê¸°! â–¶</button>
        <p style="font-size: 0.8rem; color: #aaa; margin-top: 30px;">QR URL: <span id="site-url-text"></span></p>
    </div>

    <div id="game-screen">
        
        <div id="final-goal" class="goal-area" onclick="Game.checkFinalStatus()">
            <span id="final-icon" class="goal-icon">ğŸ”’</span>
            <h3 id="final-title" class="goal-title">ë¹„ë°€ì˜ ë³´ë¬¼ìƒì</h3>
            <p id="final-progress" class="goal-progress">ì—´ì‡  ì°¾ëŠ” ì¤‘... (0/0)</p>
        </div>

        <h2>ğŸ“· QR ìŠ¤ìº”</h2>
        <div id="reader"></div>
        <p id="scan-status">ì¹´ë©”ë¼ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>

        <div class="bag-container">
            <h3 class="bag-title">ğŸ’ íšë“í•œ ì—´ì‡ ë“¤</h3>
            <div id="inventory-grid" class="grid-box"></div>
        </div>
    </div>

    <div id="modal" class="modal-overlay">
        <div class="modal-box">
            <button class="btn-secondary" style="position:absolute; top:10px; right:10px; padding:5px 10px; font-size:1rem;" onclick="Popup.close()">âœ–</button>
            <div id="modal-content"></div>
        </div>
    </div>

</div>

<script>
/**
 * ============================================================================
 * ğŸ› ï¸ [ì„ ìƒë‹˜ ì„¤ì • êµ¬ì—­] gameConfig
 * ============================================================================
 */
const gameConfig = {
    
    // 1. ê¸°ë³¸ ì„¤ì •
    meta: {
        title: "ğŸ•µï¸â€â™€ï¸ í•™êµ ë³´ë¬¼ì°¾ê¸° v11",
        subTitle: "ëª¨ë“  ë‹¨ì„œë¥¼ ëª¨ì•„ ìµœì¢… ë³´ë¬¼ì„ ì°¾ì•„ë¼!",
        siteUrl: "https://funnyjeb.github.io/qr-treasure/", 
        introImage: "https://private-user-images.githubusercontent.com/111253985/523448750-220de704-10c2-434f-98b6-e7c954fce30a.png?jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3NjUxMDQ5NDYsIm5iZiI6MTc2NTEwNDY0NiwicGF0aCI6Ii8xMTEyNTM5ODUvNTIzNDQ4NzUwLTIyMGRlNzA0LTEwYzItNDM0Zi05OGI2LWU3Yzk1NGZjZTMwYS5wbmc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjUxMjA3JTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI1MTIwN1QxMDUwNDZaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT0yOTU0ZmU1YmVhZmRhMjIwODI3YjQ5YTE4YjUxOWFkMWNlMDQ3YTZkODEzMzFiMzdkYTI0M2EzYmQxYmM3ODljJlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCJ9.QbGueywuGLyb1CF3l1UOzxEJN4dHQV3vOShliqDfd8w",
        introDesc: "í•™êµ ê³³ê³³ì— ìˆ¨ê²¨ì§„ ë™ë¬¼ì„ ëª¨ë‘ ì°¾ìœ¼ë©´,\në§¨ ìœ„ì˜ 'ë¹„ë°€ ìƒì'ê°€ ì—´ë¦½ë‹ˆë‹¤!\nê³¼ì—° ë§ˆì§€ë§‰ ë³´ë¬¼ì€ ì–´ë””ì— ìˆì„ê¹Œìš”?",
        msgCorrect: "ì •ë‹µì…ë‹ˆë‹¤! ğŸ‰",
        msgWrong: "í‹€ë ¸ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ìƒê°í•´ë³´ì„¸ìš”. ğŸ˜…",
        msgAlreadyFound: "ì´ë¯¸ ì°¾ì€ ì¹œêµ¬ì…ë‹ˆë‹¤!"
    },

    // 2. ğŸ”¥ [New] ìµœì¢… ë³´ìƒ ì„¤ì • (ëª¨ë‘ ë‹¤ ëª¨ì•˜ì„ ë•Œ)
    finalReward: {
        icon: "ğŸ", // ì—´ë ¸ì„ ë•Œ ì•„ì´ì½˜
        title: "ì¶•í•˜í•©ë‹ˆë‹¤! ë³´ë¬¼ìƒì ì˜¤í”ˆ!",
        // ìµœì¢… ì¥ì†Œ íŒíŠ¸ë‚˜ ì‚¬ì§„
        images: [
            "https://cdn-icons-png.flaticon.com/512/2855/2855523.png", 
            // ì‹¤ì œ ë³´ë¬¼ ìœ„ì¹˜ ì‚¬ì§„ì„ ì—¬ê¸°ì— ë„£ìœ¼ì„¸ìš”
        ],
        desc: "ëª¨ë“  ì—´ì‡ ë¥¼ ëª¨ì•˜ìŠµë‹ˆë‹¤!\n\nì§„ì§œ ë³´ë¬¼ì€ [ê³¼í•™ì‹¤ ë’¤í¸ ì‚¬ë¬¼í•¨] ì•ˆì— ìˆìŠµë‹ˆë‹¤.\në¹„ë°€ë²ˆí˜¸ëŠ” 1234 ì…ë‹ˆë‹¤."
    },

    // 3. QRì½”ë“œ ë°ì´í„° (ì•„ì´í…œ ë¦¬ìŠ¤íŠ¸)
    qrData: {
        "cat": {
            icon: "ğŸ¦",
            name: "ìš©ë§¹í•œ ì‚¬ì",
            quiz: {
                active: true,
                question: "ë°±ìˆ˜ì˜ ì™•ì´ë¼ ë¶ˆë¦¬ëŠ” ë™ë¬¼ì€?",
                answers: ["ì‚¬ì", "lion"]
            },
            reward: {
                images: ["https://cdn-icons-png.flaticon.com/512/616/616408.png"],
                desc: "ì‚¬ìë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤! (1ë²ˆ ì—´ì‡  íšë“)"
            }
        },
        "ball": {
            icon: "âš½",
            name: "ì¶•êµ¬ê³µ",
            quiz: {
                active: true,
                question: "ì†í¥ë¯¼ ì„ ìˆ˜ì˜ ë“±ë²ˆí˜¸ëŠ”?",
                answers: ["7", "7ë²ˆ"]
            },
            reward: {
                images: [],
                desc: "ì¶•êµ¬ê³µì„ ì°¾ì•˜ìŠµë‹ˆë‹¤! (2ë²ˆ ì—´ì‡  íšë“)"
            }
        },
        "star": {
            icon: "â­",
            name: "ë³„",
            quiz: { active: false }, // í€´ì¦ˆ ì—†ì´ íšë“
            reward: {
                images: [],
                desc: "ë°˜ì§ì´ëŠ” ë³„ì„ ì°¾ì•˜ìŠµë‹ˆë‹¤!"
            }
        }
    }
};

/**
 * ============================================================================
 * ğŸš€ [ì‹œìŠ¤í…œ ë¡œì§]
 * ============================================================================
 */
const Game = {
    foundItems: new Set(),
    totalItems: 0,
    scanner: null,
    isScanning: false,

    init: () => {
        // ë©”íƒ€ ì •ë³´ ì ìš©
        document.getElementById('title-text').innerText = gameConfig.meta.title;
        document.getElementById('subtitle-text').innerText = gameConfig.meta.subTitle;
        document.getElementById('intro-img').src = gameConfig.meta.introImage;
        document.getElementById('intro-desc').innerText = gameConfig.meta.introDesc;
        document.getElementById('site-url-text').innerText = gameConfig.meta.siteUrl;

        // ì „ì²´ ì•„ì´í…œ ìˆ˜ ê³„ì‚°
        Game.totalItems = Object.keys(gameConfig.qrData).length;
        
        // ì¸ë²¤í† ë¦¬ ë° ëª©í‘œì°½ ì´ˆê¸°í™”
        Game.updateUI();
    },

    start: () => {
        document.getElementById('start-screen').style.display = 'none';
        document.getElementById('game-screen').style.display = 'block';
        
        Game.scanner = new Html5Qrcode("reader");
        Game.scanner.start({ facingMode: "environment" }, { fps: 10, qrbox: { width: 250, height: 250 } }, Game.onScan)
        .catch(err => {
            document.getElementById('scan-status').innerText = "ì¹´ë©”ë¼ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.";
        });
        Game.isScanning = true;
    },

    onScan: (decodedText, decodedResult) => {
        if (!Game.isScanning) return;

        const id = decodedText.trim();
        const item = gameConfig.qrData[id];

        if (!item) { alert("ì˜ëª»ëœ QRì½”ë“œì…ë‹ˆë‹¤."); return; }
        if (Game.foundItems.has(id)) {
            Game.pauseScan();
            alert(gameConfig.meta.msgAlreadyFound);
            setTimeout(Game.resumeScan, 1500);
            return;
        }

        Game.pauseScan();
        if (item.quiz && item.quiz.active) {
            Popup.showQuiz(id);
        } else {
            Game.getItem(id);
        }
    },

    getItem: (id) => {
        Game.foundItems.add(id);
        Game.updateUI();
        
        // ì•„ì´í…œ íšë“ íŒì—… ë‹«ì„ ë•Œ ê²Œì„ í´ë¦¬ì–´ ì²´í¬ë¥¼ ìœ„í•´ í”Œë˜ê·¸ ì „ë‹¬
        Popup.showReward(id, true);
    },

    // í™”ë©´ ê°±ì‹  (ê°€ë°© + ìƒë‹¨ ëª©í‘œì°½)
    updateUI: () => {
        // 1. ê°€ë°© ê·¸ë¦¬ê¸°
        const grid = document.getElementById('inventory-grid');
        grid.innerHTML = "";
        Object.keys(gameConfig.qrData).forEach(key => {
            const item = gameConfig.qrData[key];
            const isFound = Game.foundItems.has(key);
            const slot = document.createElement('div');
            slot.className = `item-slot ${isFound ? '' : 'locked'}`;
            slot.innerText = isFound ? item.icon : "â“";
            if (isFound) slot.onclick = () => { Game.pauseScan(); Popup.showReward(key, false); };
            grid.appendChild(slot);
        });

        // 2. ìƒë‹¨ ëª©í‘œì°½ ì—…ë°ì´íŠ¸
        const current = Game.foundItems.size;
        const total = Game.totalItems;
        const progressText = document.getElementById('final-progress');
        const finalIcon = document.getElementById('final-icon');
        const finalTitle = document.getElementById('final-title');
        const goalArea = document.getElementById('final-goal');

        if (current >= total) {
            // í´ë¦¬ì–´ ìƒíƒœ
            finalIcon.innerText = gameConfig.finalReward.icon;
            finalTitle.innerText = "ë³´ë¬¼ìƒì ì—´ë¦¼!";
            finalTitle.style.color = "#27ae60";
            progressText.innerText = "í„°ì¹˜í•˜ì—¬ í™•ì¸í•˜ì„¸ìš”!";
            goalArea.style.backgroundColor = "#e8f8f5";
            goalArea.style.border = "2px solid #27ae60";
            goalArea.classList.add('unlocked-anim'); // í”ë“¤ë¦¬ëŠ” ì• ë‹ˆë©”ì´ì…˜
        } else {
            // ì§„í–‰ ì¤‘
            finalIcon.innerText = "ğŸ”’";
            finalTitle.innerText = "ë¹„ë°€ì˜ ë³´ë¬¼ìƒì";
            progressText.innerText = `ì—´ì‡  ì°¾ëŠ” ì¤‘... (${current}/${total})`;
        }
    },

    // ìƒë‹¨ ë³´ë¬¼ìƒì í´ë¦­ ì‹œ
    checkFinalStatus: () => {
        if (Game.foundItems.size >= Game.totalItems) {
            // ìµœì¢… ë³´ìƒ íŒì—…
            Game.pauseScan();
            Popup.showFinalReward();
        } else {
            // ì•„ì§ ë¶€ì¡±í•¨
            alert(`ì•„ì§ ì—´ì‡ ê°€ ë¶€ì¡±í•´ìš”!\n${Game.foundItems.size}ê°œ ì°¾ì•˜ìŠµë‹ˆë‹¤.\nì´ ${Game.totalItems}ê°œë¥¼ ì°¾ì•„ì•¼ í•©ë‹ˆë‹¤.`);
        }
    },

    pauseScan: () => { Game.isScanning = false; },
    resumeScan: () => { Game.isScanning = true; }
};

const Popup = {
    overlay: document.getElementById('modal'),
    content: document.getElementById('modal-content'),

    showQuiz: (id) => {
        const item = gameConfig.qrData[id];
        Popup.content.innerHTML = `
            <h2>ğŸ§© í€´ì¦ˆ!</h2>
            <p style="font-size:1.1rem; font-weight:bold;">${item.quiz.question}</p>
            <input type="text" id="quiz-input" placeholder="ì •ë‹µ ì…ë ¥" autocomplete="off">
            <br>
            <button class="btn" onclick="Popup.checkAnswer('${id}')">í™•ì¸</button>
        `;
        Popup.overlay.style.display = "flex";
    },

    checkAnswer: (id) => {
        const input = document.getElementById('quiz-input').value.trim().toLowerCase().replace(/\s+/g, '');
        const answers = gameConfig.qrData[id].quiz.answers.map(a => a.toLowerCase().replace(/\s+/g, ''));
        
        if (answers.includes(input)) {
            alert(gameConfig.meta.msgCorrect);
            Game.getItem(id);
        } else {
            alert(gameConfig.meta.msgWrong);
        }
    },

    showReward: (id, isNew) => {
        const item = gameConfig.qrData[id];
        let imgHtml = "";
        if (item.reward.images && item.reward.images.length > 0) {
            imgHtml = `<div class="image-scroll-box">` + 
                item.reward.images.map(url => `<img src="${url}" class="reward-img">`).join('') + `</div>`;
        }

        Popup.content.innerHTML = `
            <div style="font-size:3rem;">${item.icon}</div>
            <h2>${item.name}</h2>
            ${imgHtml}
            <div style="background:#f9f9f9; padding:10px; border-radius:10px; text-align:left; white-space: pre-wrap;">${item.reward.desc}</div>
            <button class="btn btn-secondary" onclick="Popup.closeAndCheckClear()">í™•ì¸</button>
        `;
        Popup.overlay.style.display = "flex";
    },

    // ìµœì¢… ë³´ìƒ íŒì—…
    showFinalReward: () => {
        const final = gameConfig.finalReward;
        let imgHtml = "";
        if (final.images && final.images.length > 0) {
            imgHtml = `<div class="image-scroll-box">` + 
                final.images.map(url => `<img src="${url}" class="reward-img">`).join('') + `</div>`;
        }

        Popup.content.innerHTML = `
            <div style="font-size:4rem;">${final.icon}</div>
            <h2 style="color:#27ae60;">${final.title}</h2>
            ${imgHtml}
            <div style="background:#e8f8f5; padding:15px; border-radius:10px; text-align:left; white-space: pre-wrap; font-weight:bold;">${final.desc}</div>
            <button class="btn" onclick="Popup.close()">ë‹«ê¸°</button>
        `;
        Popup.overlay.style.display = "flex";
    },

    // íŒì—… ë‹«ì„ ë•Œ í´ë¦¬ì–´ ì—¬ë¶€ í™•ì¸í•´ì„œ ë°”ë¡œ ìµœì¢…í™”ë©´ ë„ì›Œì£¼ê¸°
    closeAndCheckClear: () => {
        Popup.close();
        // ë§ˆì§€ë§‰ ì•„ì´í…œì´ì—ˆë‹¤ë©´ ë°”ë¡œ ìµœì¢… íŒì—… ë„ìš°ê¸°
        if (Game.foundItems.size === Game.totalItems) {
            setTimeout(() => {
                alert("ğŸ‰ ëª¨ë“  ì—´ì‡ ë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤! ë³´ë¬¼ìƒìê°€ ì—´ë¦½ë‹ˆë‹¤!");
                Popup.showFinalReward();
            }, 500);
        }
    },

    close: () => {
        Popup.overlay.style.display = "none";
        Game.resumeScan();
    }
};

document.addEventListener("DOMContentLoaded", Game.init);
</script>
</body>
</html>
