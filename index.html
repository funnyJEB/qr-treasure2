<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>QR ë³´ë¬¼ì°¾ê¸° byê¸ˆë°°ê³¼í•™</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Gamja+Flower&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>

    <style>
        /* [ìŠ¤íƒ€ì¼ ì •ì˜] */
        :root {
            --primary: #4CAF50;
            --secondary: #FF9800;
            --danger: #FF5722;
            --bg: #F0F9F0;
            --text: #333;
        }
        body {
            font-family: 'Gamja Flower', sans-serif;
            background-color: var(--bg);
            margin: 0;
            padding: 0;
            color: var(--text);
            text-align: center;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        .container {
            max-width: 500px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* 1. ì‹œì‘ í™”ë©´ */
        #start-screen {
            padding: 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
        }
        .main-img { width: 80%; max-height: 300px; object-fit: cover; border-radius: 20px; margin: 20px 0; }

        /* 2. ê²Œì„ í™”ë©´ */
        #game-screen { display: none; padding: 20px; padding-bottom: 80px; }
        
        /* ì¹´ë©”ë¼ ì˜ì—­ */
        #camera-area {
            width: 100%;
            min-height: 300px;
            background: #000;
            border-radius: 20px;
            margin-bottom: 20px;
            overflow: hidden;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.2);
        }

        #reader { width: 100%; height: 100%; }
        #reader video {
            width: 100% !important;
            height: 100% !important;
            object-fit: cover !important;
        }

        /* ê°€ì§œ í•˜ì–€ í…Œë‘ë¦¬ */
        .scan-frame {
            position: absolute;
            width: 200px;
            height: 200px;
            border: 4px solid rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            box-shadow: 0 0 0 100vmax rgba(0, 0, 0, 0.6);
            pointer-events: none;
            z-index: 10;
        }
        
        /* [ìˆ˜ì •ë¨] ì¹´ë©”ë¼ ëŒ€ê¸° í™”ë©´ (ë°ì€ í…Œë§ˆ ì ìš©!) */
        #camera-placeholder {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            
            /* ğŸ”¥ ì—ë©”ë„ë“œ ìˆ² í…Œë§ˆ (ë°ì€ ì´ˆë¡ìƒ‰) */
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
            z-index: 20;
            transition: all 0.2s;
        }
        #camera-placeholder:active { transform: scale(0.98); filter: brightness(0.9); }
        
        .camera-icon { 
            font-size: 5rem; 
            margin-bottom: 15px; 
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.2));
        }
        .camera-text {
            font-size: 1.5rem;
            font-weight: bold;
            border: 3px solid rgba(255,255,255,0.8);
            padding: 10px 25px;
            border-radius: 50px;
            background: rgba(255,255,255,0.2);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        /* ëª©í‘œ êµ¬ì—­ */
        .goal-area {
            background: #fff8e1;
            border: 2px dashed var(--secondary);
            border-radius: 15px;
            padding: 10px;
            margin-bottom: 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        .goal-icon { font-size: 3rem; }
        .goal-info { text-align: left; }
        .goal-title { font-size: 1.2rem; margin: 0; color: #d35400; font-weight: bold; }
        .goal-progress { font-size: 0.9rem; color: #666; margin-top: 2px; }
        
        @keyframes shake {
            0% { transform: rotate(0deg); } 25% { transform: rotate(-5deg); }
            50% { transform: rotate(5deg); } 75% { transform: rotate(-5deg); } 100% { transform: rotate(0deg); }
        }
        .unlocked-anim { animation: shake 0.5s infinite; border-color: #27ae60 !important; background: #e8f8f5 !important; }

        /* ê°€ë°© */
        .bag-container { background: #eee; border-radius: 15px; padding: 15px; }
        .grid-box { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-top: 10px;}
        
        /* ì•„ì´í…œ ìŠ¬ë¡¯ */
        .item-slot {
            aspect-ratio: 1/1; background: white; border-radius: 10px;
            display: flex; align-items: center; justify-content: center;
            font-size: 2rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            cursor: pointer; position: relative;
            transition: transform 0.1s;
        }
        .item-slot.locked { 
            filter: grayscale(100%); opacity: 0.4; background: #e0e0e0;
            cursor: default; transform: scale(0.95);
        }
        .item-slot.found {
            filter: grayscale(0%); opacity: 1; border: 2px solid var(--primary);
        }
        .item-slot.found:active { transform: scale(0.9); }
        .item-check { position: absolute; bottom: -5px; right: -5px; font-size: 1rem; filter: none !important;}

        /* íŒì—… */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); z-index: 999; display: none;
            align-items: center; justify-content: center;
        }
        .modal-box {
            background: white; width: 85%; max-width: 320px; max-height: 80vh;
            overflow-y: auto; border-radius: 20px; padding: 20px; 
            text-align: center; position: relative; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .image-scroll-box {
            display: flex; flex-direction: column; gap: 10px; margin: 15px 0;
            max-height: 200px; overflow-y: auto; border-radius: 10px;
        }
        .reward-img { width: 100%; border-radius: 10px; }

        .btn {
            background: var(--primary); color: white; border: none;
            padding: 10px 20px; font-size: 1.1rem; border-radius: 50px;
            cursor: pointer; font-family: 'Gamja Flower', sans-serif; margin-top: 10px; width: 100%;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }
        .btn:active { transform: translateY(2px); box-shadow: none; }
        .btn-secondary { background: var(--secondary); }
        .btn-danger { background: var(--danger); }
        
        input[type="text"] {
            width: 80%; padding: 10px; font-size: 1.1rem;
            border: 2px solid #ddd; border-radius: 10px; margin: 10px 0; text-align: center;
            font-family: 'Gamja Flower', sans-serif;
        }

        /* ê´€ë¦¬ì */
        .admin-btn {
            margin-top: 30px; background: none; border: 1px solid #ccc; color: #999;
            padding: 5px 10px; border-radius: 5px; font-size: 0.8rem; cursor: pointer;
        }
        .admin-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin: 15px 0; }
        .admin-item { border: 2px solid #ddd; border-radius: 10px; padding: 10px; font-size: 1.5rem; cursor: pointer; }
        .admin-item:hover { background: #ffebee; border-color: red; }

        /* í† ìŠ¤íŠ¸ ë©”ì‹œì§€ */
        #toast {
            visibility: hidden; min-width: 250px; background-color: rgba(0,0,0,0.8); color: #fff;
            text-align: center; border-radius: 50px; padding: 16px; position: fixed;
            z-index: 1000; left: 50%; bottom: 80px; transform: translateX(-50%);
            font-size: 1rem; opacity: 0; transition: opacity 0.3s;
        }
        #toast.show { visibility: visible; opacity: 1; }
    </style>
</head>
<body>

<div class="container">
    
    <div id="start-screen">
        <h1 id="title-text" style="font-size: 2.5rem; margin-bottom: 10px;">ë¡œë”©ì¤‘...</h1>
        <p id="subtitle-text" style="font-size: 1.2rem; color: #666;">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”</p>
        <img id="intro-img" class="main-img" src="" alt="Intro">
        <p id="intro-desc" style="white-space: pre-wrap;">ì„¤ëª…ê¸€ ë¡œë”©ì¤‘...</p>
        <button class="btn" onclick="Game.initGame()">ëª¨í—˜ ì‹œì‘í•˜ê¸° â–¶</button>
        <p style="font-size: 0.8rem; color: #aaa; margin-top: 30px;">QR URL: <span id="site-url-text"></span></p>
    </div>

    <div id="game-screen">
        
        <div id="final-goal" class="goal-area" onclick="Game.checkFinalStatus()">
            <div id="final-icon" class="goal-icon">ğŸ</div>
            <div class="goal-info">
                <div id="final-title" class="goal-title">ë³´ë¬¼ìƒì</div>
                <div id="final-progress" class="goal-progress">ì—´ì‡  ëª¨ìœ¼ëŠ” ì¤‘... (0/0)</div>
            </div>
        </div>

        <div id="camera-area">
            <div id="reader"></div>
            
            <div class="scan-frame"></div>

            <div id="camera-placeholder" onclick="Game.openCamera()">
                <div class="camera-icon">ğŸ“·</div>
                <div class="camera-text">ì¹´ë©”ë¼ ì¼œê¸°</div>
            </div>
        </div>

        <div class="bag-container">
            <div style="font-weight: bold; margin-bottom: 5px;">ğŸ’ ë‚˜ì˜ ê°€ë°©</div>
            <div id="inventory-grid" class="grid-box"></div>
        </div>

        <button class="admin-btn" onclick="Admin.openMenu()">âš™ï¸ ê´€ë¦¬ì ì„¤ì •</button>
    </div>

    <div id="modal" class="modal-overlay">
        <div class="modal-box">
            <button class="btn-secondary" style="position:absolute; top:10px; right:10px; padding:5px 10px; font-size:1rem; width:auto;" onclick="Popup.close()">âœ–</button>
            <div id="modal-content"></div>
        </div>
    </div>

    <div id="admin-modal" class="modal-overlay">
        <div class="modal-box">
            <h2 style="margin-top:0;">âš™ï¸ ê´€ë¦¬ì ì„¤ì •</h2>
            <button class="btn btn-danger" onclick="Admin.resetAll()">ğŸ”„ ì „ì²´ ë°ì´í„° ì´ˆê¸°í™”</button>
            <hr style="margin: 20px 0; border: 0; border-top: 1px solid #eee;">
            <p style="text-align:left; font-weight:bold; margin-bottom:5px;">ğŸ—‘ï¸ ì°¾ì•„ë‚¸ QR ì·¨ì†Œí•˜ê¸°</p>
            <div id="admin-list" class="admin-grid"></div>
            <button class="btn btn-secondary" onclick="Admin.closeMenu()">ë‹«ê¸°</button>
        </div>
    </div>
    
    <div id="toast">ë©”ì‹œì§€</div>

</div>

<script>
/**
 * ============================================================================
 * ğŸ› ï¸ [gameConfig] ì„¤ì • ì˜ì—­
 * ============================================================================
 */
const gameConfig = {
    meta: {
        title: "ğŸ•µï¸â€â™€ï¸ QR ë³´ë¬¼ì°¾ê¸°",
        subTitle: "ìˆ¨ê²¨ì§„ QRë“¤ì„ ëª¨ë‘ ì°¾ì•„ ë³´ë¬¼ìƒìë¥¼ ì—´ì–´ë³´ì„¸ìš”!",
        siteUrl: "https://funnyjeb.github.io/qr-treasure2", 
        introImage: "./images/start.png",
        introDesc: `1. ì£¼ë³€ì— ìˆ¨ê²¨ì§„ QRì„ ì°¾ì•„ë³´ì„¸ìš”.
        2. QRì„ ì°¾ì•˜ë‹¤ë©´ 'ì¹´ë©”ë¼ ì¼œê¸°'ë¥¼ ëˆŒëŸ¬ ìŠ¤ìº”!
        3. ì •í™•í•œ QRì„ ì¸ì‹í•˜ë©´ íŠ¹ë³„í•œ ì¼ì´ ì¼ì–´ë‚˜ìš”.
        4. ë¬¸ì œê°€ ë‚˜ì˜¨ë‹¤ë©´ ì •ë‹µë„ ë§ì¶°ì•¼ í•´ìš”!
        5. ëª¨ë“  QRì„ ì°¾ì•„ ë³´ë¬¼ìƒìë¥¼ ì—´ì—ˆë‹¤ë©´ ì„ ìƒë‹˜ê»˜ ì˜¤ì„¸ìš”!`,
        msgCorrect: "ì •ë‹µì…ë‹ˆë‹¤! ğŸ‰",
        msgWrong: "í‹€ë ¸ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ë³´ì„¸ìš”. ğŸ˜…",
        msgAlreadyFound: "ì´ë¯¸ ì°¾ì€ ë³´ë¬¼ì…ë‹ˆë‹¤!"
    },
    finalReward: {
        icon: "ğŸ”“", title: "ì¶•í•˜í•©ë‹ˆë‹¤!",
        images: ["https://cdn-icons-png.flaticon.com/512/2855/2855523.png"], 
        desc: `ëª¨ë“  ë¯¸ì…˜ì„ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤!
        ì„ ìƒë‹˜ê»˜ ì´ í™”ë©´ì„ ë³´ì—¬ì£¼ì„¸ìš”.`
    },
    qrData: {
        "saturn": {
            icon: "ğŸª", name: "í† ì„±",
            quiz: { active: true, question: "íƒœì–‘ê³„ í–‰ì„±ì¤‘ ê°€ì¥ í¬ê³  ë¬´ê±°ìš´ í–‰ì„±ì€?", answers: ["ëª©ì„±"] },
            reward: { desc: "í† ì„±ì„ ì°¾ì•˜ìŠµë‹ˆë‹¤!\në‹¤ìŒ ì¥ì†Œì— ëŒ€í•œ íŒíŠ¸ â¬‡ï¸", images: ["https://cdn-icons-png.flaticon.com/512/616/616408.png"] }
        },
        "dog": {
            icon: "ğŸ¶", name: "ê°•ì•„ì§€",
            quiz: { active: true, question: "ë³„ì˜ ì¼ì£¼ ìš´ë™ì€ ì§€êµ¬ê°€ OOí•˜ê¸° ë•Œë¬¸ì— ë‚˜íƒ€ë‚œë‹¤.", answers: ["ìì „"] },
            reward: { desc: "ê°•ì•„ì§€ë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤!\në‹¤ìŒ ì¥ì†Œì— ëŒ€í•œ íŒíŠ¸ â¬‡ï¸", images: ["https://cdn-icons-png.flaticon.com/512/616/616408.png"] }
        },
        "airplane": {
            icon: "âœˆï¸", name: "ë¹„í–‰ê¸°",
            quiz: { active: true, question: "íƒœì–‘ì˜ ì½”ë¡œë‚˜ë¥¼ ë³¼ ìˆ˜ ìˆëŠ” ì‹œê¸°ëŠ”?", answers: ["ê°œê¸° ì¼ì‹", "ê°œê¸°ì¼ì‹"] },
            reward: { desc: "ë¹„í–‰ê¸°ë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤!\në‹¤ìŒ ì¥ì†Œì— ëŒ€í•œ íŒíŠ¸ â¬‡ï¸", images: ["https://cdn-icons-png.flaticon.com/512/616/616408.png"] }
        },
        "pen": {
            icon: "âœ’ï¸", name: "íœ",
            quiz: { active: true, question: "ë‹¬ì´ íƒœì–‘ê³¼ ê°€ì¥ ë©€ë¦¬ ìˆì„ ë•Œì˜ ìœ„ìƒì€?", answers: ["ë§", "ë³´ë¦„"] },
            reward: { desc: "íœì„ ì°¾ì•˜ìŠµë‹ˆë‹¤!\në‹¤ìŒ ì¥ì†Œì— ëŒ€í•œ íŒíŠ¸ â¬‡ï¸", images: ["https://cdn-icons-png.flaticon.com/512/616/616408.png"] }
        },
        "bird": {
            icon: "ğŸ¦", name: "ìƒˆ",
            quiz: { active: true, question: "íƒœì–‘ í‘œë©´ì— ìŒ€ì•Œë¬´ëŠ¬ëŠ” íƒœì–‘ì´ ooí•˜ê¸° ë•Œë¬¸ì— ë‚˜íƒ€ë‚œë‹¤.", answers: ["ëŒ€ë¥˜"] },
            reward: { desc: "ìƒˆë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤!\në‹¤ìŒ ì¥ì†Œì— ëŒ€í•œ íŒíŠ¸ â¬‡ï¸", images: ["https://cdn-icons-png.flaticon.com/512/616/616408.png"] }
        },
        "crown": {
            icon: "ğŸ‘‘", name: "ì™•ê´€",
            quiz: { active: true, question: "íƒœì–‘ì˜ ëŒ€ê¸°ì—ì„œ ê´€ì°°ë˜ëŠ” ê³ ë¦¬í˜•íƒœì˜ ë¶ˆê½ƒì˜ ì´ë¦„ì€?", answers: ["í™ì—¼"] },
            reward: { desc: "ì™•ê´€ì„ ì°¾ì•˜ìŠµë‹ˆë‹¤!\në‹¤ìŒ ì¥ì†Œì— ëŒ€í•œ íŒíŠ¸ â¬‡ï¸", images: ["https://cdn-icons-png.flaticon.com/512/616/616408.png"] }
        },
        "telescope": {
            icon: "ğŸ”­", name: "ë§ì›ê²½",
            quiz: { active: true, question: "ì•ˆì „í•˜ê²Œ í‘ì ì„ ê´€ì°°í•˜ê¸° ìœ„í•´ í•„ìš”í•œ ë„êµ¬ëŠ”?", answers: ["íˆ¬ì˜íŒ", "íƒœì–‘í•„í„°", "íƒœì–‘ í•„í„°"] },
            reward: { desc: "ë§ì›ê²½ì„ ì°¾ì•˜ìŠµë‹ˆë‹¤!\në‹¤ìŒ ì¥ì†Œì— ëŒ€í•œ íŒíŠ¸ â¬‡ï¸", images: ["https://cdn-icons-png.flaticon.com/512/616/616408.png"] }
        },
        "star": {
            icon: "â­", name: "ë³„",
            quiz: { active: true, question: "8ì›”ì— í•´ê°€ ì§„ ì§í›„ ì„œìª½ ì§€í‰ì„  ê·¼ì²˜ì— ë³´ì´ëŠ” ë³„ìë¦¬ëŠ”?", answers: ["ì‚¬ììë¦¬"] },
            reward: { desc: "ë³„ì„ ì°¾ì•˜ìŠµë‹ˆë‹¤!\në‹¤ìŒ ì¥ì†Œì— ëŒ€í•œ íŒíŠ¸ â¬‡ï¸", images: ["https://cdn-icons-png.flaticon.com/512/616/616408.png"] }
        }
    }
};

/**
 * ============================================================================
 * ğŸš€ [ì‹œìŠ¤í…œ ë¡œì§]
 * ============================================================================
 */
const STORAGE_KEY = "qr_treasure_v13_save";

const Game = {
    foundItems: new Set(),
    totalItems: 0,
    scanner: null,

    init: () => {
        document.getElementById('title-text').innerText = gameConfig.meta.title;
        document.getElementById('subtitle-text').innerText = gameConfig.meta.subTitle;
        document.getElementById('intro-img').src = gameConfig.meta.introImage;
        document.getElementById('intro-desc').innerText = gameConfig.meta.introDesc;
        document.getElementById('site-url-text').innerText = gameConfig.meta.siteUrl;

        Game.totalItems = Object.keys(gameConfig.qrData).length;
        const savedData = localStorage.getItem(STORAGE_KEY);
        if (savedData) {
            const parsed = JSON.parse(savedData);
            parsed.forEach(id => { if(gameConfig.qrData[id]) Game.foundItems.add(id); });
        }
        Game.updateUI();
    },

    initGame: () => {
        document.getElementById('start-screen').style.display = 'none';
        document.getElementById('game-screen').style.display = 'block';
    },

    openCamera: () => {
        document.getElementById('camera-placeholder').style.display = 'none';
        
        if(!Game.scanner) {
            Game.scanner = new Html5Qrcode("reader");
        }
        
        const config = { fps: 10 };
        
        Game.scanner.start({ facingMode: "environment" }, config, Game.onScan)
        .catch(err => {
            alert("ì¹´ë©”ë¼ ì‹œì‘ ì˜¤ë¥˜ (HTTPS í•„ìˆ˜): " + err);
            Game.closeCamera();
        });
    },

    closeCamera: () => {
        if(Game.scanner) {
            Game.scanner.stop().then(() => {
                Game.scanner.clear();
                document.getElementById('camera-placeholder').style.display = 'flex';
            }).catch(err => {
                console.log("Stop failed", err);
                document.getElementById('camera-placeholder').style.display = 'flex';
            });
        } else {
            document.getElementById('camera-placeholder').style.display = 'flex';
        }
    },

    onScan: (decodedText, decodedResult) => {
        Game.closeCamera();

        const id = decodedText.trim();
        const item = gameConfig.qrData[id];

        if (!item) { 
            Toast.show("ì•Œ ìˆ˜ ì—†ëŠ” QRì½”ë“œì…ë‹ˆë‹¤.");
            return; 
        }

        if (Game.foundItems.has(id)) {
            Toast.show(gameConfig.meta.msgAlreadyFound);
            return;
        }

        if (item.quiz && item.quiz.active) {
            Popup.showQuiz(id);
        } else {
            Game.getItem(id);
        }
    },

    getItem: (id) => {
        Game.foundItems.add(id);
        localStorage.setItem(STORAGE_KEY, JSON.stringify([...Game.foundItems]));
        Game.updateUI();
        Popup.showReward(id, true);
    },

    updateUI: () => {
        const grid = document.getElementById('inventory-grid');
        grid.innerHTML = "";
        Object.keys(gameConfig.qrData).forEach(key => {
            const item = gameConfig.qrData[key];
            const isFound = Game.foundItems.has(key);
            
            const slot = document.createElement('div');
            slot.className = `item-slot ${isFound ? 'found' : 'locked'}`;
            slot.innerText = item.icon;
            
            if (isFound) {
                slot.innerHTML += `<span class="item-check">âœ…</span>`;
                slot.onclick = () => { Popup.showReward(key, false); };
            }
            grid.appendChild(slot);
        });

        const current = Game.foundItems.size;
        const total = Game.totalItems;
        const goalArea = document.getElementById('final-goal');
        const finalTitle = document.getElementById('final-title');
        const finalIcon = document.getElementById('final-icon');

        if (current >= total) {
            finalIcon.innerText = gameConfig.finalReward.icon;
            finalTitle.innerText = "ìƒì ì—´ë¦¼! (í„°ì¹˜)";
            finalTitle.style.color = "#27ae60";
            document.getElementById('final-progress').innerText = "ëª¨ë“  ì—´ì‡  íšë“! í„°ì¹˜í•˜ì„¸ìš”.";
            goalArea.classList.add('unlocked-anim');
        } else {
            finalIcon.innerText = "ğŸ";
            finalTitle.innerText = "ìµœì¢… ë³´ë¬¼ìƒì";
            finalTitle.style.color = "#d35400";
            document.getElementById('final-progress').innerText = `ì—´ì‡  ëª¨ìœ¼ëŠ” ì¤‘... (${current}/${total})`;
            goalArea.classList.remove('unlocked-anim');
        }
    },

    checkFinalStatus: () => {
        if (Game.foundItems.size >= Game.totalItems) {
            Popup.showFinalReward();
        } else {
            Toast.show(`ì•„ì§ ì—´ì‡ ê°€ ë¶€ì¡±í•´ìš”! (${Game.foundItems.size}/${Game.totalItems})`);
        }
    }
};

const Popup = {
    overlay: document.getElementById('modal'),
    content: document.getElementById('modal-content'),

    showQuiz: (id) => {
        const item = gameConfig.qrData[id];
        Popup.content.innerHTML = `
            <h2>ğŸ§© í€´ì¦ˆ!</h2>
            <p style="font-size:1.2rem; font-weight:bold;">${item.quiz.question}</p>
            <input type="text" id="quiz-input" placeholder="ì •ë‹µ ì…ë ¥" autocomplete="off">
            <br>
            <div id="quiz-msg" style="color:red; height:20px; font-size:0.9rem;"></div>
            <button class="btn" onclick="Popup.checkAnswer('${id}')">í™•ì¸</button>
        `;
        Popup.overlay.style.display = "flex";
        document.getElementById('quiz-input').focus();
    },

    checkAnswer: (id) => {
        const input = document.getElementById('quiz-input').value.trim().toLowerCase().replace(/\s+/g, '');
        const answers = gameConfig.qrData[id].quiz.answers.map(a => a.toLowerCase().replace(/\s+/g, ''));
        if (answers.includes(input)) {
            Toast.show(gameConfig.meta.msgCorrect);
            Game.getItem(id);
        } else {
            document.getElementById('quiz-msg').innerText = gameConfig.meta.msgWrong;
            const inputEl = document.getElementById('quiz-input');
            inputEl.value = ""; inputEl.focus();
            inputEl.style.borderColor = "red";
            setTimeout(() => inputEl.style.borderColor = "#ddd", 500);
        }
    },

    showReward: (id, isNew) => {
        const item = gameConfig.qrData[id];
        let imgHtml = "";
        if (item.reward.images && item.reward.images.length > 0) {
            imgHtml = `<div class="image-scroll-box">` + 
                item.reward.images.map(url => `<img src="${url}" class="reward-img">`).join('') + `</div>`;
        }
        
        Popup.content.innerHTML = `
            <div style="font-size:4rem;">${item.icon}</div>
            <h2>${item.name}</h2>
            
            <div style="background:#f9f9f9; padding:10px; border-radius:10px; text-align:left; white-space: pre-wrap;">${item.reward.desc}</div>
            
            ${imgHtml}
            
            <button class="btn btn-secondary" onclick="Popup.closeAndCheckClear()">í™•ì¸</button>
        `;
        Popup.overlay.style.display = "flex";
    },

    showFinalReward: () => {
        const final = gameConfig.finalReward;
        let imgHtml = "";
        if (final.images && final.images.length > 0) {
            imgHtml = `<div class="image-scroll-box">` + 
                final.images.map(url => `<img src="${url}" class="reward-img">`).join('') + `</div>`;
        }
        Popup.content.innerHTML = `
            <div style="font-size:4rem;">${final.icon}</div>
            <h2 style="color:#27ae60;">${final.title}</h2>
            ${imgHtml}
            <div style="background:#e8f8f5; padding:15px; border-radius:10px; text-align:left; white-space: pre-wrap; font-weight:bold;">${final.desc}</div>
            <button class="btn" onclick="Popup.close()">ë‹«ê¸°</button>
        `;
        Popup.overlay.style.display = "flex";
    },

    closeAndCheckClear: () => {
        Popup.close();
        if (Game.foundItems.size === Game.totalItems) {
            setTimeout(() => { Toast.show("ğŸ‰ ëª¨ë“  ë¯¸ì…˜ ì™„ë£Œ!"); Popup.showFinalReward(); }, 600);
        }
    },

    close: () => {
        Popup.overlay.style.display = "none";
    }
};

const Admin = {
    openMenu: () => {
        const password = prompt("ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸");
        if (password !== "1234") {
            if(password !== null) alert("ë¹„ë°€ë²ˆí˜¸ ë¶ˆì¼ì¹˜");
            return;
        }
        Admin.renderList();
        document.getElementById('admin-modal').style.display = 'flex';
    },

    closeMenu: () => {
        document.getElementById('admin-modal').style.display = 'none';
        Game.updateUI(); 
    },

    renderList: () => {
        const list = document.getElementById('admin-list');
        list.innerHTML = "";
        if(Game.foundItems.size === 0) {
            list.innerHTML = "<p style='grid-column:1/-1; color:#999;'>ì°¾ì€ ì•„ì´í…œì´ ì—†ìŠµë‹ˆë‹¤.</p>";
            return;
        }
        Game.foundItems.forEach(id => {
            const item = gameConfig.qrData[id];
            const div = document.createElement('div');
            div.className = "admin-item";
            div.innerHTML = item.icon;
            div.onclick = () => Admin.deleteItem(id);
            list.appendChild(div);
        });
    },

    deleteItem: (id) => {
        const item = gameConfig.qrData[id];
        if(confirm(`'${item.name}' (${item.icon}) íšë“ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
            Game.foundItems.delete(id);
            localStorage.setItem(STORAGE_KEY, JSON.stringify([...Game.foundItems]));
            Admin.renderList(); 
            Toast.show("ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
        }
    },

    resetAll: () => {
        if(confirm("ğŸš¨ ê²½ê³ : ì°¾ì•„ë‚¸ ëª¨ë“  QRì´ ì‚¬ë¼ì§‘ë‹ˆë‹¤.\nì •ë§ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            localStorage.removeItem(STORAGE_KEY);
            location.reload();
        }
    }
};

const Toast = {
    show: (message) => {
        const toast = document.getElementById("toast");
        toast.className = "show";
        toast.innerText = message;
        setTimeout(() => toast.className = toast.className.replace("show", ""), 3000);
    }
};

document.addEventListener("DOMContentLoaded", Game.init);
</script>
</body>
</html>
