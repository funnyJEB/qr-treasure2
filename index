<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>QR ë³´ë¬¼ì°¾ê¸° v10</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Gamja+Flower&display=swap" rel="stylesheet">
    
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>

    <style>
        /* [ìŠ¤íƒ€ì¼ ì •ì˜] ìˆ˜ì •í•˜ì§€ ì•Šì•„ë„ ì˜ˆì˜ê²Œ ë‚˜ì˜µë‹ˆë‹¤ */
        :root {
            --primary: #4CAF50;
            --secondary: #FF9800;
            --bg: #F0F9F0;
            --text: #333;
        }
        body {
            font-family: 'Gamja Flower', sans-serif;
            background-color: var(--bg);
            margin: 0;
            padding: 0;
            color: var(--text);
            text-align: center;
        }
        
        /* ì»¨í…Œì´ë„ˆ */
        .container {
            max-width: 500px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
        }

        /* 1. ì‹œì‘ í™”ë©´ */
        #start-screen {
            padding: 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
        }
        .main-img {
            width: 80%;
            max-height: 300px;
            object-fit: cover;
            border-radius: 20px;
            margin: 20px 0;
            box-shadow: 0 5px 10px rgba(0,0,0,0.1);
        }

        /* 2. ê²Œì„ í™”ë©´ */
        #game-screen {
            display: none;
            padding: 20px;
        }
        #reader {
            width: 100%;
            border-radius: 15px;
            overflow: hidden;
            background: #000;
            margin-bottom: 20px;
        }

        /* ê°€ë°© (ì¸ë²¤í† ë¦¬) */
        .bag-container {
            background: #eee;
            border-radius: 15px;
            padding: 15px;
            margin-top: 10px;
        }
        .bag-title { margin: 0 0 10px 0; font-size: 1.2rem; }
        .grid-box {
            display: grid;
            grid-template-columns: repeat(4, 1fr); /* í•œ ì¤„ì— 4ê°œ */
            gap: 10px;
        }
        .item-slot {
            aspect-ratio: 1/1;
            background: white;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: transform 0.1s;
        }
        .item-slot.locked { color: #ccc; background: #ddd; cursor: default; }
        .item-slot:active { transform: scale(0.9); }

        /* 3. íŒì—… (í€´ì¦ˆ & ë³´ìƒ) */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 999;
            display: none; /* í‰ì†Œì—” ìˆ¨ê¹€ */
            align-items: center;
            justify-content: center;
        }
        .modal-box {
            background: white;
            width: 85%;
            max-width: 400px;
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
            position: relative;
            max-height: 85vh;
            overflow-y: auto;
        }
        .close-btn {
            position: absolute;
            top: 15px; right: 15px;
            background: none; border: none;
            font-size: 1.5rem; cursor: pointer;
        }
        
        /* ì´ë¯¸ì§€ ìŠ¬ë¼ì´ë“œ (ì—¬ëŸ¬ ì¥ì¼ ê²½ìš°) */
        .image-scroll-box {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 15px 0;
            max-height: 250px;
            overflow-y: auto; /* ì„¸ë¡œ ìŠ¤í¬ë¡¤ */
            border: 1px solid #eee;
            padding: 5px;
            border-radius: 10px;
        }
        .reward-img { width: 100%; border-radius: 10px; }

        /* ê³µí†µ ë²„íŠ¼ */
        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 1.2rem;
            border-radius: 50px;
            cursor: pointer;
            font-family: 'Gamja Flower', sans-serif;
            margin-top: 10px;
        }
        .btn-secondary { background: var(--secondary); }
        
        input[type="text"] {
            width: 80%;
            padding: 10px;
            font-size: 1.1rem;
            border: 2px solid #ddd;
            border-radius: 10px;
            margin: 10px 0;
            text-align: center;
            font-family: 'Gamja Flower', sans-serif;
        }
    </style>
</head>
<body>

<div class="container">
    
    <div id="start-screen">
        <h1 id="title-text" style="font-size: 2.5rem; margin-bottom: 10px;">ë¡œë”©ì¤‘...</h1>
        <p id="subtitle-text" style="font-size: 1.2rem; color: #666;">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”</p>
        
        <img id="intro-img" class="main-img" src="" alt="Intro">
        
        <p id="intro-desc" style="white-space: pre-wrap;">ì„¤ëª…ê¸€ ë¡œë”©ì¤‘...</p>
        
        <button class="btn" onclick="Game.start()">íƒí—˜ ì‹œì‘í•˜ê¸°! â–¶</button>
        
        <p style="font-size: 0.8rem; color: #aaa; margin-top: 30px;">
            QR URL: <span id="site-url-text"></span>
        </p>
    </div>

    <div id="game-screen">
        <h2>ğŸ“· QR ì½”ë“œë¥¼ ë¹„ì¶°ì£¼ì„¸ìš”</h2>
        <div id="reader"></div>
        <p id="scan-status">ì¹´ë©”ë¼ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>

        <div class="bag-container">
            <h3 class="bag-title">ğŸ’ ë‚˜ì˜ ë³´ë¬¼ ê°€ë°©</h3>
            <div id="inventory-grid" class="grid-box">
                </div>
        </div>
    </div>

    <div id="modal" class="modal-overlay">
        <div class="modal-box">
            <button class="close-btn" onclick="Popup.close()">âœ–</button>
            
            <div id="modal-content"></div>
        </div>
    </div>

</div>

<script>
/**
 * ============================================================================
 * ğŸ› ï¸ [ì„ ìƒë‹˜ ì„¤ì • êµ¬ì—­] gameConfig
 * ì´ ê³³ì˜ ë‚´ìš©ë§Œ ìˆ˜ì •í•˜ë©´ ê²Œì„ì˜ ëª¨ë“  ê²ƒì´ ë°”ë€ë‹ˆë‹¤!
 * ============================================================================
 */
const gameConfig = {
    
    // 1. ê¸°ë³¸ ì„¤ì •
    meta: {
        title: "ğŸ•µï¸â€â™€ï¸ ìˆ²ì†ì˜ ë™ë¬¼ ì°¾ê¸° v10",
        subTitle: "í•™êµ ì •ì›ì— ìˆ¨ê²¨ì§„ ì¹œêµ¬ë“¤ì„ ì°¾ì•„ë¼!",
        
        // ì´ ì£¼ì†ŒëŠ” í™”ë©´ í•˜ë‹¨ì— í‘œì‹œë˜ì–´ ì„ ìƒë‹˜ì´ í™•ì¸í•˜ê¸° ì¢‹ìŠµë‹ˆë‹¤.
        siteUrl: "https://teacher.github.io/qr-game", 
        
        // ì‹œì‘ í™”ë©´ ì´ë¯¸ì§€ (ê¹ƒí—ˆë¸Œ ì´ìŠˆ ì´ë¯¸ì§€ ì£¼ì†Œ ì¶”ì²œ)
        introImage: "https://images.unsplash.com/photo-1596495578065-6e0763fa1178?ixlib=rb-1.2.1&auto=format&fit=crop&w=600&q=80",
        
        introDesc: `[ê²Œì„ ë°©ë²•]
1. í•™êµ ê³³ê³³ì— ìˆ¨ê²¨ì§„ QRì½”ë“œë¥¼ ì°¾ìœ¼ì„¸ìš”.
2. í€´ì¦ˆë¥¼ ë§íˆë©´ ë™ë¬¼ì„ íšë“í•©ë‹ˆë‹¤.
3. íšë“í•œ ë™ë¬¼ì€ 'ê°€ë°©'ì—ì„œ ë‹¤ì‹œ ë³¼ ìˆ˜ ìˆì–´ìš”.`,

        // ë©”ì‹œì§€ ì„¤ì •
        msgCorrect: "ì •ë‹µì…ë‹ˆë‹¤! ğŸ‰ ë³´ë¬¼ì„ íšë“í–ˆì–´ìš”!",
        msgWrong: "ì €ëŸ°.. ì •ë‹µì´ ì•„ë‹™ë‹ˆë‹¤. ğŸ˜… ë‹¤ì‹œ ìƒê°í•´ë³´ì„¸ìš”!",
        msgAlreadyFound: "ì´ë¯¸ ì°¾ì€ ì¹œêµ¬ì…ë‹ˆë‹¤! ê°€ë°©ì„ í™•ì¸í•´ë³´ì„¸ìš”."
    },

    // 2. QRì½”ë“œ ë°ì´í„° (ì•„ì´í…œ ë¦¬ìŠ¤íŠ¸)
    // QRì½”ë“œë¥¼ ë§Œë“¤ ë•Œ ì‚¬ìš©í•˜ëŠ” ë‹¨ì–´("cat", "ball")ê°€ ê³§ IDê°€ ë©ë‹ˆë‹¤.
    qrData: {
        
        // [1ë²ˆ ì•„ì´í…œ] ì‚¬ì
        "cat": {
            icon: "ğŸ¦", // ê°€ë°©ì— í‘œì‹œë  ì•„ì´ì½˜
            name: "ìš©ë§¹í•œ ì‚¬ì",
            
            // í€´ì¦ˆ ì„¤ì • (ì£¼ê´€ì‹)
            quiz: {
                active: true, // í€´ì¦ˆ ìˆìŒ
                question: "ì´ ë™ë¬¼ì€ 'ë°±ìˆ˜ì˜ ì™•'ì…ë‹ˆë‹¤. ëˆ„êµ¬ì¼ê¹Œìš”?",
                answers: ["ì‚¬ì", "lion", "ìˆ«ì‚¬ì"] // ì •ë‹µ ë¦¬ìŠ¤íŠ¸ (ìœ ì‚¬ ë‹µì•ˆ í¬í•¨)
            },
            
            // ë³´ìƒ (ì´ë¯¸ì§€ ì—¬ëŸ¬ ì¥ ê°€ëŠ¥)
            reward: {
                images: [
                    "https://cdn-icons-png.flaticon.com/512/616/616408.png", // ì˜ˆì‹œ ì´ë¯¸ì§€
                    // ì—¬ê¸°ì— ì´ë¯¸ì§€ ì£¼ì†Œë¥¼ ì½¤ë§ˆ(,)ë¡œ ê³„ì† ì¶”ê°€í•˜ë©´ ë¨
                ],
                desc: "ì¶•í•˜í•©ë‹ˆë‹¤! ì‚¬ìëŠ” ë³¸ê´€ 1ì¸µ ê±°ìš¸ ì•ì— ìˆ¨ì–´ìˆì—ˆìŠµë‹ˆë‹¤.\n(ê°€ë°©ì—ì„œ ì–¸ì œë“  ë‹¤ì‹œ ë³¼ ìˆ˜ ìˆì–´ìš”)"
            }
        },

        // [2ë²ˆ ì•„ì´í…œ] ì¶•êµ¬ê³µ
        "ball": {
            icon: "âš½",
            name: "ì „ì„¤ì˜ ì¶•êµ¬ê³µ",
            
            quiz: {
                active: true,
                question: "ì†í¥ë¯¼ ì„ ìˆ˜ì˜ ë“±ë²ˆí˜¸ëŠ” ëª‡ ë²ˆì¼ê¹Œìš”?",
                answers: ["7", "7ë²ˆ", "ì¹ ", "seven"]
            },
            
            reward: {
                images: [], // ì´ë¯¸ì§€ê°€ ì—†ìœ¼ë©´ ë¹ˆì¹¸ []
                desc: "ìš´ë™ì¥ ê³¨ëŒ€ ë’¤í¸ìœ¼ë¡œ ê°€ë³´ì„¸ìš”! ë‹¤ìŒ íŒíŠ¸ê°€ ìˆìŠµë‹ˆë‹¤."
            }
        },

        // [3ë²ˆ ì•„ì´í…œ] ì§€ë„ (í€´ì¦ˆ ì—†ì´ ë°”ë¡œ íšë“í•˜ëŠ” ì˜ˆì‹œ)
        "map": {
            icon: "ğŸ—ºï¸",
            name: "ë³´ë¬¼ ì§€ë„",
            
            quiz: {
                active: false // í€´ì¦ˆ ì—†ìŒ (ë°”ë¡œ íšë“)
            },
            
            reward: {
                images: ["https://cdn-icons-png.flaticon.com/512/854/854878.png"],
                desc: "ì§€ë„ë¥¼ íšë“í–ˆìŠµë‹ˆë‹¤! ë³„í‘œì‹œ ëœ ê³³ìœ¼ë¡œ ê°€ì„¸ìš”."
            }
        }
        
        // ì—¬ê¸°ì— ê³„ì† ì¶”ê°€ ê°€ëŠ¥...
        // "key": { ... },
    }
};

/**
 * ============================================================================
 * ğŸš€ [ì‹œìŠ¤í…œ ë¡œì§]
 * ì´ ì•„ë˜ëŠ” ì½”ë“œë¥¼ ì˜ ì•„ëŠ” ê²½ìš°ê°€ ì•„ë‹ˆë©´ ìˆ˜ì •í•˜ì§€ ì•Šì•„ë„ ë©ë‹ˆë‹¤.
 * ============================================================================
 */

const Game = {
    foundItems: new Set(), // ì°¾ì€ ì•„ì´í…œ ID ì €ì¥
    scanner: null,
    isScanning: false,

    // ì´ˆê¸°í™”
    init: () => {
        // ë©”íƒ€ ì •ë³´ ì ìš©
        document.getElementById('title-text').innerText = gameConfig.meta.title;
        document.getElementById('subtitle-text').innerText = gameConfig.meta.subTitle;
        document.getElementById('intro-img').src = gameConfig.meta.introImage;
        document.getElementById('intro-desc').innerText = gameConfig.meta.introDesc;
        document.getElementById('site-url-text').innerText = gameConfig.meta.siteUrl;

        // ì¸ë²¤í† ë¦¬ ìƒì„±
        Game.renderInventory();
    },

    // ê²Œì„ ì‹œì‘ (ì¹´ë©”ë¼ ì¼œê¸°)
    start: () => {
        document.getElementById('start-screen').style.display = 'none';
        document.getElementById('game-screen').style.display = 'block';
        
        // QR ìŠ¤ìºë„ˆ ì‹¤í–‰
        Game.scanner = new Html5Qrcode("reader");
        const config = { fps: 10, qrbox: { width: 250, height: 250 } };
        
        Game.scanner.start({ facingMode: "environment" }, config, Game.onScan)
        .catch(err => {
            document.getElementById('scan-status').innerText = "ì¹´ë©”ë¼ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤. ìƒˆë¡œê³ ì¹¨ í•´ì£¼ì„¸ìš”.";
        });
        Game.isScanning = true;
    },

    // ìŠ¤ìº” ì„±ê³µ ì‹œ
    onScan: (decodedText, decodedResult) => {
        // íŒì—…ì´ ë– ìˆìœ¼ë©´ ìŠ¤ìº” ë¬´ì‹œ
        if (!Game.isScanning) return;

        const id = decodedText.trim(); // ê³µë°± ì œê±°
        const item = gameConfig.qrData[id];

        // 1. ìœ íš¨í•˜ì§€ ì•Šì€ QRì¸ ê²½ìš°
        if (!item) {
            alert("ì´ ê²Œì„ì˜ QRì½”ë“œê°€ ì•„ë‹™ë‹ˆë‹¤.");
            return;
        }

        // 2. ì´ë¯¸ ì°¾ì€ ê²½ìš°
        if (Game.foundItems.has(id)) {
            // ìŠ¤ìº” ì ì‹œ ì¤‘ì§€ (ì¤‘ë³µ ì•Œë¦¼ ë°©ì§€)
            Game.pauseScan();
            alert(gameConfig.meta.msgAlreadyFound);
            setTimeout(Game.resumeScan, 2000); // 2ì´ˆ ë’¤ ì¬ê°œ
            return;
        }

        // 3. ìƒˆë¡œìš´ ì•„ì´í…œ ë°œê²¬! -> í€´ì¦ˆ or ì¦‰ì‹œ íšë“
        Game.pauseScan(); // íŒì—… ë„ìš°ëŠ” ë™ì•ˆ ìŠ¤ìº” ì¤‘ì§€
        
        if (item.quiz && item.quiz.active) {
            Popup.showQuiz(id);
        } else {
            Game.getItem(id);
        }
    },

    // ì•„ì´í…œ íšë“ ì²˜ë¦¬
    getItem: (id) => {
        Game.foundItems.add(id);
        Game.renderInventory(); // ê°€ë°© ì—…ë°ì´íŠ¸
        Popup.showReward(id, true); // ë³´ìƒ íŒì—… (ì²« íšë“)
    },

    // ì¸ë²¤í† ë¦¬(ê°€ë°©) ê·¸ë¦¬ê¸°
    renderInventory: () => {
        const grid = document.getElementById('inventory-grid');
        grid.innerHTML = ""; // ì´ˆê¸°í™”

        // qrDataì— ìˆëŠ” ëª¨ë“  í‚¤ë¥¼ ê°€ì ¸ì™€ì„œ ì¹¸ ë§Œë“¤ê¸°
        Object.keys(gameConfig.qrData).forEach(key => {
            const item = gameConfig.qrData[key];
            const isFound = Game.foundItems.has(key);
            
            const slot = document.createElement('div');
            slot.className = `item-slot ${isFound ? '' : 'locked'}`;
            slot.innerText = isFound ? item.icon : "â“";
            
            // ì°¾ì€ ì•„ì´í…œì€ í´ë¦­í•˜ë©´ ë‹¤ì‹œ ë³´ê¸° ê°€ëŠ¥
            if (isFound) {
                slot.onclick = () => {
                    Game.pauseScan(); // ë³´ëŠ” ë™ì•ˆ ìŠ¤ìº” ì¤‘ì§€
                    Popup.showReward(key, false);
                };
            }
            
            grid.appendChild(slot);
        });
    },

    pauseScan: () => { Game.isScanning = false; },
    resumeScan: () => { Game.isScanning = true; }
};

const Popup = {
    overlay: document.getElementById('modal'),
    content: document.getElementById('modal-content'),

    // í€´ì¦ˆ ë³´ì—¬ì£¼ê¸°
    showQuiz: (id) => {
        const item = gameConfig.qrData[id];
        const q = item.quiz;

        Popup.content.innerHTML = `
            <h2 style="margin-top:0;">ğŸ§© í€´ì¦ˆ ë„ì „!</h2>
            <p style="font-size:1.1rem; font-weight:bold;">${q.question}</p>
            <input type="text" id="quiz-input" placeholder="ì •ë‹µì„ ì…ë ¥í•˜ì„¸ìš”" autocomplete="off">
            <br>
            <button class="btn" onclick="Popup.checkAnswer('${id}')">í™•ì¸</button>
        `;
        Popup.overlay.style.display = "flex";
    },

    // ì •ë‹µ í™•ì¸
    checkAnswer: (id) => {
        const input = document.getElementById('quiz-input').value.trim().toLowerCase().replace(/\s+/g, ''); // ê³µë°±ì œê±°, ì†Œë¬¸ì
        const answers = gameConfig.qrData[id].quiz.answers.map(a => a.toLowerCase().replace(/\s+/g, ''));
        
        if (answers.includes(input)) {
            // ì •ë‹µ!
            alert(gameConfig.meta.msgCorrect);
            Game.getItem(id); // ë³´ìƒ í™”ë©´ìœ¼ë¡œ ë„˜ì–´ê°
        } else {
            // ì˜¤ë‹µ
            alert(gameConfig.meta.msgWrong);
            document.getElementById('quiz-input').value = "";
            document.getElementById('quiz-input').focus();
        }
    },

    // ë³´ìƒ/ì •ë³´ ë³´ì—¬ì£¼ê¸° (isNew: ì²˜ìŒ ì–»ì—ˆëŠ”ì§€, ë‹¤ì‹œë³´ëŠ”ì§€)
    showReward: (id, isNew) => {
        const item = gameConfig.qrData[id];
        
        // ì´ë¯¸ì§€ HTML ìƒì„± (ì—¬ëŸ¬ ì¥ì¼ ê²½ìš° ëª¨ë‘ í‘œì‹œ)
        let imgHtml = "";
        if (item.reward.images && item.reward.images.length > 0) {
            imgHtml = `<div class="image-scroll-box">`;
            item.reward.images.forEach(url => {
                imgHtml += `<img src="${url}" class="reward-img"><br>`;
            });
            imgHtml += `</div>`;
        }

        Popup.content.innerHTML = `
            <div style="font-size:3rem;">${item.icon}</div>
            <h2 style="margin: 10px 0;">${item.name}</h2>
            ${imgHtml}
            <div style="background:#f9f9f9; padding:10px; border-radius:10px; text-align:left; white-space: pre-wrap;">${item.reward.desc}</div>
            <button class="btn btn-secondary" onclick="Popup.close()">í™•ì¸</button>
        `;
        Popup.overlay.style.display = "flex";
    },

    close: () => {
        Popup.overlay.style.display = "none";
        Game.resumeScan(); // íŒì—… ë‹«ìœ¼ë©´ ë‹¤ì‹œ ìŠ¤ìº” ì‹œì‘
    }
};

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹œì‘
document.addEventListener("DOMContentLoaded", Game.init);

</script>
</body>
</html>
